@using HRExpert.Organization.DTO
@model HRExpert.Organization.ViewModels.SicklistListViewModel
@{
    this.Layout = "_Layout";
    ViewBag.Title = "Больничные";

}
<ul class="breadcrumb">
    <li><a href="#">Табель</a></li>
    <li><a href="#">@ViewBag.Title</a></li>
</ul>
<div class="panel panel-default">
    <div class="panel-heading">Фильтр</div>
    <div class="panel-body FilterContainer">
        <fieldset class="form-horizontal">
            <form method="post">
                @Html.HiddenFor(x => x.OrderBy)
                @Html.HiddenFor(x => x.OrderDirection)
                <div class="form-group ">
                    <label for="personName" class="col-sm-2">Подразделение:</label>
                    <div class="col-sm-10">
                        <div class="input-group">
                            <input type="text" class="form-control" id="Filter_DepartmentName" value="@Model.Filter.DepartmentName" name="Filter.DepartmentName"  readonly="readonly"/>
                            <div class="input-group-btn">
                                <input type="button" value="Выбрать" class="btn btn-default" id="Filter_DepartmentSelectButton" />
                            </div>
                        </div>
                        @Html.HiddenFor(x => x.Filter.DepartmentId)
                   </div>
                </div>
                <div class="form-group ">
                    <label for="personName" class="col-sm-2">ФИО сотрудника:</label>
                    <div class="col-sm-10">
                        @Html.EditorFor(x => x.Filter.PersonName, new { htmlAttributes = new { @class = "form-control", placeholder = "ФИО сотрудника" } })
                    </div>
                </div>
                <div class="form-group ">
                    <label class="col-sm-2">Дата начала:</label>
                    <div class="col-sm-10">
                        @Html.EditorFor(x => x.Filter.BeginDate, new { htmlAttributes = new { @class = "form-control" } })
                    </div>
                </div>
                <div class="form-group ">
                    <label class="col-sm-2">Дата окончания:</label>
                    <div class="col-sm-10">
                        @Html.EditorFor(x => x.Filter.EndDate, new { htmlAttributes = new { @class = "form-control" } })
                    </div>
                </div>
                <button type="submit" class="btn btn-info">Выбрать</button>
                <input type="button" value="Очистить" class="btn btn-default" onclick="HRexpert.ClearFilter()" />
            </form>
        </fieldset>
    </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-body ControlsContainer">
            <a href="@Url.Action("Create","Sicklist")" class="btn btn-primary">Создать заявку</a>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">Заявки</div>
        <div class="panel-body TableContainer">
            <table class="table table-bordered table-striped table-hover">
                <thead>
                    <tr>
                        <th onclick="ChangeSort('Data.Id')">Номер заявки</th>
                        <th onclick="ChangeSort('CreateDate')">Дата создания</th>
                        <th onclick="ChangeSort('Person.Name')">ФИО</th>
                        <th onclick="ChangeSort('Person.StaffEstablishedPost.Position.Name')">Должность</th>
                        <th onclick="ChangeSort('Person.StaffEstablishedPost.Department.Name')">Подразделение</th>
                        <th onclick="ChangeSort('Data.SicklistNumber')">Номер больничного листа</th>
                        <th onclick="ChangeSort('Data.SicklistType.Name')">Вид больничного</th>
                        <th onclick="ChangeSort('Data.BeginDate')">Дата начала</th>
                        <th onclick="ChangeSort('Data.EndDate')">Дата окончания</th>
                        <th onclick="ChangeSort('Data.Status.Name')">Статус документа</th>
                        <th onclick="ChangeSort('Data.ApproveStatus')">Этап согласования</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var element in Model.Documents)
            {
                        <tr>
                            <td>@Html.ActionLink(element.Data.Id.ToString(), "Edit", new { Id = element.Data.Id }) <span class="badge"></span></td>
                            <td>@element.CreateDate</td>
                            <td>@element.Person.Name</td>
                            <td>@element.Person.StaffEstablishedPost.Position.Name</td>
                            <td>@element.Person.StaffEstablishedPost.Department.Name</td>
                            <td>@element.Data.SicklistNumber</td>
                            <td>@element.Data.SicklistType.Name</td>
                            <td>@element.Data.BeginDate</td>
                            <td>@element.Data.EndDate</td>
                            <td>@element.Status?.Name</td>
                            <td>@element.Data.ApproveStatus</td>
                        </tr>
            }
                </tbody>
            </table>
        </div>
    </div>
    <script>
        function ChangeSort(column) {
            var direction = $('#OrderDirection');
            var orderby = $('#OrderBy')
            if (orderby.val() == column) direction.val() = !direction.val();
            orderby.val(column);
            document.forms[0].submit();
        }
        $(document).ready(function () {
            HRexpert.TypicalInit();
            var DepartmentSelectDialog;
            $('#Filter_DepartmentSelectButton').click(function ()
            {
                HRexpert.Factory.CreateDepartmentSelectDialog('Filter_DepartmentId', 'Filter_DepartmentName',function(dialog){dialog.dialog('open');});
            });
        });
            
    </script>
